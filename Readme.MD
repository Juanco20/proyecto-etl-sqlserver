# üê≥ Proyecto ETL: SQL Server + Python Ingestion

Este proyecto despliega un entorno contenerizado que consiste en una base de datos **Microsoft SQL Server** y un servicio de **Python** que realiza una ingesta autom√°tica de datos al arrancar.

El objetivo es proporcionar una plantilla lista para usar que resuelva la configuraci√≥n de drivers ODBC y la comunicaci√≥n entre contenedores.

## üìã Requisitos Previos

* [Docker](https://www.docker.com/products/docker-desktop) instalado.
* [Docker Compose](https://docs.docker.com/compose/install/) instalado.

## üöÄ Inicio R√°pido

1.  **Construir y levantar los servicios:**
    Abre una terminal en la ra√≠z del proyecto y ejecuta:

    ```bash
    docker-compose up --build
    ```

2.  **¬øQu√© suceder√°?**
    * Se descargar√° la imagen de SQL Server 2022.
    * Se construir√° la imagen de Python instalando los drivers `msodbcsql17`.
    * **Esperar a la BD:** El contenedor de Python esperar√° autom√°ticamente (gracias al `healthcheck`) a que SQL Server est√© listo para aceptar conexiones.
    * **Ejecuci√≥n:** Python crear√° la tabla `datos_prueba` e insertar√° un registro.
    * **Verificaci√≥n:** Ver√°s en la consola la impresi√≥n de los datos insertados.

3.  **Detener el entorno:**
    Para detener los contenedores presiona `Ctrl + C`. Para eliminar los contenedores y redes:

    ```bash
    docker-compose down
    ```

---

## üìÇ Estructura del Proyecto

```text
proyecto-etl-sqlserver/
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ Dockerfile         # Configuraci√≥n de imagen Python + Drivers ODBC
‚îÇ   ‚îú‚îÄ‚îÄ main.py            # Script de l√≥gica de negocio (ETL)
‚îÇ   ‚îî‚îÄ‚îÄ requirements.txt   # Librer√≠as Python (pandas, pyodbc)
‚îú‚îÄ‚îÄ docker-compose.yml     # Orquestador de servicios
‚îî‚îÄ‚îÄ README.md              # Documentaci√≥n

```

## ‚öôÔ∏è Configuraci√≥n y Variables de Entorno

Las credenciales est√°n definidas en el archivo `docker-compose.yml`.

| Variable | Valor por Defecto | Descripci√≥n |
| --- | --- | --- |
| `DB_HOST` | `db` | Nombre del servicio en la red de Docker. |
| `DB_USER` | `sa` | Usuario administrador de SQL Server. |
| `DB_PASS` | `TuPasswordFuerte123!` | **Importante:** SQL Server requiere contrase√±as complejas (May√∫sculas, min√∫sculas, n√∫meros). |
| `DB_NAME` | `master` | Base de datos por defecto. |

> **Nota:** Si cambias la contrase√±a en el servicio `db`, aseg√∫rate de actualizarla tambi√©n en las variables de entorno del servicio `ingesta`.

## üì° Conexi√≥n Manual a la Base de Datos

Si deseas conectar una herramienta externa (como DBeaver, Azure Data Studio o SSMS) mientras el contenedor est√° corriendo, usa los siguientes par√°metros:

* **Host:** `localhost` (o `127.0.0.1`)
* **Puerto:** `1433`
* **Usuario:** `sa`
* **Contrase√±a:** `TuPasswordFuerte123!`

## üõ† Detalles T√©cnicos

### Healthcheck

El `docker-compose.yml` incluye un *healthcheck* en el servicio de base de datos. Esto previene el error com√∫n donde Python intenta conectarse antes de que la base de datos haya terminado de iniciarse.

### Drivers ODBC

El `Dockerfile` en la carpeta `app/` instala las librer√≠as del sistema necesarias para `pyodbc` en Linux (Debian/Ubuntu), espec√≠ficamente `unixodbc-dev` y `msodbcsql17`.

## üßπ Limpieza de Datos

Los datos de la base de datos persisten en un volumen de Docker llamado `sql_data`. Si deseas reiniciar la base de datos desde cero (borrar todos los datos), ejecuta:

```bash
docker-compose down -v

```

*(La bandera `-v` elimina los vol√∫menes asociados).*

---

Desarrollado con ‚ù§Ô∏è y Docker.